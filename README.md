# MySQL运维进阶指南

《MySQL运维进阶指南》即是《MySQL管理之道：性能调优、高可用与监控（第2版）》一书的第三版。

选题思路

本书以构建高性能MySQL服务器为核心，介绍了MySQL 8.0和MariaDB 10.5版本的新特性，从故障诊断与优化、性能调优、备份与恢复、MySQL高可用集群搭建与管理、OLAP数据仓库搭建、MySQL服务器性能和服务监控、SQL自动审核上线等方面多角度深入讲解了如何去管理与维护MySQL服务器。

书中内容以实战为导向，所有内容均来自于笔者多年实践经验的总结和新知识的拓展，同时也针对运维人员、DBA等相关工作者会遇到的有代表性的疑难问题给出了实用的情景模拟，并给出了解决方案。

不论你目前有没有遇到过此类问题，相信对你以后处理相关问题都会有所借鉴。

# 目录
第1章 MariaDB 10.5 新特性	1
1.1 MariaDB概述	1
1.2 	MariaDB 10.5与MySQL 8.0之间的不兼容性和功能差异	2
1.2.1存储引擎	3
1.2.2扩展和新功能	3
1.3	 如何将MySQL迁移至MariaDB	4
1.4 MariaDB 10.5新特性详解	6
1.4.1客户端连接层改进	7
1.4.2服务层改进	27
1.4.3InnoDB存储引擎层改进	71
1.5 总结	81
第2章 MySQL 8.0 新特性	82
2.1 MySQL 8.0概述	82
2.2 MySQL 8.0新特性详解	82
2.2.1性能提升	85
2.2.2客户端连接层改进	87
2.2.3服务层改进	95
2.2.4优化器改进	100
2.2.5同步复制改进	121
2.2.6InnoDB存储引擎层改进	128
2.2.7 pt-upgrade工具检测SQL语法兼容性	143
2.3总结	145
第二部分 故障诊断与性能优化篇	145
第3章 故障诊断	145
3.1 影响MySQL性能的因素	145
3.2 系统性能评估标准	147
3.2.1 影响Linux服务器性能的因素	147
3.2.2 系统性能评估指标	148
3.2.3 开源监控和评估工具介绍	150
3.3 故障与处理	156
3.3.1  pt-online-schema-change修改表结构是否安全？	156
3.3.2  pt-osc修改外键时，内部是如何处理的？	159
3.3.3 删除大表的小技巧	161
3.3.4  Percona pt-archiver重构版：轻松归档大表数据	162
3.3.5  Percona pt-kill改造版（PHP）：慢SQL报警及扼杀利器	166
3.3.6  自适应哈希索引引起的不定时MySQL崩溃重启	169
3.3.7  诊断事务量突高的原因	172
3.3.8  谨慎设置binlog_format=MIXED	175
3.3.9  MySQL故障切换之事件调度器（event）注意事项	180
3.3.10  误操作恢复	183
3.3.11  快速恢复二进制日志	187
第4章 同步复制报错故障处理	188
4.1 最常见的三种故障	188
4.1.1 在主库上删除一条记录而导致的故障	189
4.1.2 主键重复	191
4.1.3 在主库上更新了一条记录，在从库上却找不到	192
4.2 特殊情况：从库的中继日志受到损坏	193
4.3 多台从库中存在重复的server-id	196
4.4 避免在主库上执行大事务	196
4.5	slave_exec_mode参数可自动处理同步复制错误	198
4.6 如何验证主从数据是否一致	200
4.7  binlog_ignore_db引起的同步复制故障	203
4.8在从库上恢复指定表的简要方法	205
4.9 如何干净地清除从库的同步信息	206
第5章 性能调优	208
5.1 表设计规范	209
5.2 字段类型的选取	214
5.2.1数值类型	214
5.2.2字符类型	220
5.2.3时间类型	224
5.3 采用合适的锁机制	232
5.3.1 表锁	233
5.3.2 行锁	236
5.3.3 行锁转表锁	238
5.3.4 死锁	240
5.4 选择合适的事务隔离级别	241
5.4.1 事务的概念	242
5.4.2  事务的实现	243
5.4.3  事务隔离级别介绍	245
5.5  SQL优化与合理利用索引	257
5.5.1慢查询的定位方法	257
5.5.2  SQL优化案例分析	258
5.5.3  合理使用索引	270
5.6  my.cnf配置文件调优	279
5.6.1 per_thread_buffers优化	280
5.6.2  global_buffers优化	282
5.6.3 Query Cache在不同环境下的使用	283
5.7  MySQL约定	284
5.8  SQL自动审核-自助上线平台	298
5.8.1 简介	298
5.8.2 规则	299
第6章 备份与恢复	301
6.1 冷备份	302
6.2 逻辑备份	303
6.2.1 mysqldump增加了一个重要参数	304
6.2.2 取代mysqldump的新工具mydumper	305
6.3 热备份与恢复	309
6.3.1 XtraBackup工作原理介绍	310
6.3.2 使用Percona XtraBackup 8.0备份MySQL 8.0	314
6.3.3 MariaDB热备份工具mariabackup	315
第7章 高可用架构集群管理	316
7.1 MaxScale高可用架构介绍	317
7.1.1 功能概述	318
7.1.2 MaxScale高可用架构搭建演示	319
7.1.3 模拟故障转移测试	325
7.1.4 总结	328
7.2 MySQL组复制高可用架构介绍	329
7.2.1 组复制的工作原理	330
7.2.2 组复制的特性和注意事项	335
7.2.3 组复制的使用方法	337
第8章 MySQL架构演进：一主多从、读写分离	341
8.1  实现读写分离的两种方式	342
8.2  主从同步延迟的判断标准	346
8.4  读写分离MariaDB MaxScale架构搭建演示	358
8.4.1  配置环境及安装介绍	358
8.4.2  基于连接方式的测试	363
8.4.3 基于语句方式（SQL解析）的测试	364
8.4.4  MaxScale延迟检测	365
第9章 TSpider分库分表的搭建与管理	368
9.1  TSpider简介	370
9.1.1 TSpider的使用场景	370
9.1.2 TSpider取模扩容问题	379
9.1.3 TSpider负载均衡架构设计	380
9.2  Tdbctl简介	380
9.2.1 Tdbctl组件安装	381
9.2.2 Tdbctl重要参数说明	382
9.2.3 Tdbctl配置管理	383
9.2.4 Tdbctl组件验证	383
9.3 小结	384
第10章 MySQL监控管理平台	385
10.1  图形可视化监控工具MySQL Monitor	386
10.1.1 简介	386
10.1.2 环境搭建	390
10.1.3 搭建MySQL Monitor工具	391
10.2  图形化显示MySQL慢日志工具Slowquery	393
10.2.1 简介	393
10.2.2 环境搭建	394
10.2.3 Slowquery工具搭建配置	394
10.3 小结	400



### 因截稿前，最新知识点没有写入书中，读者可通过以下链接获取。

#### 1）MariaDB 10.6 (GA)新特性的变化和改进
https://blog.51cto.com/hcymysql/4751791

#### 2）ansible-simple简易版
https://blog.51cto.com/hcymysql/4973090

#### 3）mysql_monitor提供podman镜像
https://blog.51cto.com/hcymysql/4984088

#### 4）MHA Re-Edition复刻版轻松实现MySQL高可用故障转移
https://blog.51cto.com/hcymysql/5037430

#### 5) 循环分批次批量更改数据10万行记录
https://github.com/hcymysql/update_10w

#### 6) pt-upgrade检测升级到8.0的SQL语法兼容性
https://blog.51cto.com/hcymysql/5300422

#### 7）SQL自动审核-自助上线平台
https://github.com/hcymysql/sqlops

#### 8) 【王炸功能】MariaDB 10.8 Alter修改表结构实现从库无延迟并行复制
https://blog.51cto.com/hcymysql/5350905

#### 9) mydumper支持Stream流式备份恢复
https://blog.51cto.com/hcymysql/5375537

#### 10) 借助LogAnalyzer打造轻量级数据库审计日志平台
https://blog.51cto.com/hcymysql/5385309

-----------------------------------
